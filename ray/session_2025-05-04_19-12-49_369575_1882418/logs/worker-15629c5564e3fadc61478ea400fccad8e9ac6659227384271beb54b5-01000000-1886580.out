:job_id:01000000
INFO 05-04 19:13:28 [__init__.py:239] Automatically detected platform cuda.
:actor_name:WorkerDict
actor will use global batch size 24.
Model config: Qwen2_5_VLConfig {
  "architectures": [
    "Qwen2_5_VLForConditionalGeneration"
  ],
  "attention_dropout": 0.0,
  "eos_token_id": 151645,
  "hidden_act": "silu",
  "hidden_size": 2048,
  "image_token_id": 151655,
  "initializer_range": 0.02,
  "intermediate_size": 11008,
  "max_position_embeddings": 128000,
  "max_window_layers": 70,
  "model_type": "qwen2_5_vl",
  "num_attention_heads": 16,
  "num_hidden_layers": 36,
  "num_key_value_heads": 2,
  "pad_token_id": 151643,
  "rms_norm_eps": 1e-06,
  "rope_scaling": {
    "mrope_section": [
      16,
      24,
      24
    ],
    "rope_type": "default",
    "type": "default"
  },
  "rope_theta": 1000000.0,
  "sliding_window": 32768,
  "tie_word_embeddings": true,
  "torch_dtype": "bfloat16",
  "transformers_version": "4.51.3",
  "use_cache": true,
  "use_sliding_window": false,
  "video_token_id": 151656,
  "vision_config": {
    "depth": 32,
    "fullatt_block_indexes": [
      7,
      15,
      23,
      31
    ],
    "hidden_act": "silu",
    "hidden_size": 1280,
    "in_channels": 3,
    "in_chans": 3,
    "intermediate_size": 3420,
    "model_type": "qwen2_5_vl",
    "num_heads": 16,
    "out_hidden_size": 2048,
    "patch_size": 14,
    "spatial_merge_size": 2,
    "spatial_patch_size": 14,
    "temporal_patch_size": 2,
    "tokens_per_second": 2,
    "window_size": 112
  },
  "vision_end_token_id": 151653,
  "vision_start_token_id": 151652,
  "vision_token_id": 151654,
  "vocab_size": 151936
}

Ulysses patch applied!
NCCL version 2.21.5+cuda12.4
Qwen2_5_VLForConditionalGeneration contains 3.75B parameters.
After huggingface model init: 12.34 GB / 93.02 GB.
FSDP wrap policy: functools.partial(<function transformer_auto_wrap_policy at 0x7c37582f2d40>, transformer_layer_cls={<class 'transformers.models.qwen2_5_vl.modeling_qwen2_5_vl.Qwen2_5_VLDecoderLayer'>, <class 'transformers.models.qwen2_5_vl.modeling_qwen2_5_vl.Qwen2_5_VLVisionBlock'>}).
After FSDP module init: 20.76 GB / 93.02 GB.
Model config: Qwen2_5_VLConfig {
  "architectures": [
    "Qwen2_5_VLForConditionalGeneration"
  ],
  "attention_dropout": 0.0,
  "eos_token_id": 151645,
  "hidden_act": "silu",
  "hidden_size": 2048,
  "image_token_id": 151655,
  "initializer_range": 0.02,
  "intermediate_size": 11008,
  "max_position_embeddings": 128000,
  "max_window_layers": 70,
  "model_type": "qwen2_5_vl",
  "num_attention_heads": 16,
  "num_hidden_layers": 36,
  "num_key_value_heads": 2,
  "pad_token_id": 151643,
  "rms_norm_eps": 1e-06,
  "rope_scaling": {
    "mrope_section": [
      16,
      24,
      24
    ],
    "rope_type": "default",
    "type": "default"
  },
  "rope_theta": 1000000.0,
  "sliding_window": 32768,
  "tie_word_embeddings": true,
  "torch_dtype": "bfloat16",
  "transformers_version": "4.51.3",
  "use_cache": true,
  "use_sliding_window": false,
  "video_token_id": 151656,
  "vision_config": {
    "depth": 32,
    "fullatt_block_indexes": [
      7,
      15,
      23,
      31
    ],
    "hidden_act": "silu",
    "hidden_size": 1280,
    "in_channels": 3,
    "in_chans": 3,
    "intermediate_size": 3420,
    "model_type": "qwen2_5_vl",
    "num_heads": 16,
    "out_hidden_size": 2048,
    "patch_size": 14,
    "spatial_merge_size": 2,
    "spatial_patch_size": 14,
    "temporal_patch_size": 2,
    "tokens_per_second": 2,
    "window_size": 112
  },
  "vision_end_token_id": 151653,
  "vision_start_token_id": 151652,
  "vision_token_id": 151654,
  "vocab_size": 151936
}

Ulysses patch applied!
Qwen2_5_VLForConditionalGeneration contains 3.75B parameters.
After huggingface model init: 20.92 GB / 93.02 GB.
FSDP wrap policy: functools.partial(<function transformer_auto_wrap_policy at 0x7c37582f2d40>, transformer_layer_cls={<class 'transformers.models.qwen2_5_vl.modeling_qwen2_5_vl.Qwen2_5_VLDecoderLayer'>, <class 'transformers.models.qwen2_5_vl.modeling_qwen2_5_vl.Qwen2_5_VLVisionBlock'>}).
After FSDP module init: 28.17 GB / 93.02 GB.
After optimizer init: 28.17 GB / 93.02 GB.
After offload actor model during init: 27.72 GB / 93.02 GB.
After offload actor optimizer during init: 27.72 GB / 93.02 GB.
INFO 05-04 19:14:18 [config.py:689] This model supports multiple tasks: {'score', 'reward', 'classify', 'generate', 'embed'}. Defaulting to 'generate'.
INFO 05-04 19:14:18 [config.py:1672] Disabling V1 multiprocessing for external launcher.
INFO 05-04 19:14:18 [config.py:1901] Chunked prefill is enabled with max_num_batched_tokens=8192.
INFO 05-04 19:14:20 [core.py:61] Initializing a V1 LLM engine (v0.8.4) with config: model='Qwen/Qwen2.5-VL-3B-Instruct', speculative_config=None, tokenizer='Qwen/Qwen2.5-VL-3B-Instruct', skip_tokenizer_init=False, tokenizer_mode=auto, revision=None, override_neuron_config=None, tokenizer_revision=None, trust_remote_code=False, dtype=torch.bfloat16, max_seq_len=4096, download_dir=None, load_format=LoadFormat.DUMMY, tensor_parallel_size=1, pipeline_parallel_size=1, disable_custom_all_reduce=True, quantization=None, enforce_eager=False, kv_cache_dtype=auto,  device_config=cuda, decoding_config=DecodingConfig(guided_decoding_backend='auto', reasoning_backend=None), observability_config=ObservabilityConfig(show_hidden_metrics=False, otlp_traces_endpoint=None, collect_model_forward_time=False, collect_model_execute_time=False), seed=1, served_model_name=Qwen/Qwen2.5-VL-3B-Instruct, num_scheduler_steps=1, multi_step_stream_outputs=True, enable_prefix_caching=True, chunked_prefill_enabled=True, use_async_output_proc=True, disable_mm_preprocessor_cache=True, mm_processor_kwargs=None, pooler_config=None, compilation_config={"level":3,"custom_ops":["none"],"splitting_ops":["vllm.unified_attention","vllm.unified_attention_with_output"],"use_inductor":true,"compile_sizes":[],"use_cudagraph":true,"cudagraph_num_of_warmups":1,"cudagraph_capture_sizes":[512,504,496,488,480,472,464,456,448,440,432,424,416,408,400,392,384,376,368,360,352,344,336,328,320,312,304,296,288,280,272,264,256,248,240,232,224,216,208,200,192,184,176,168,160,152,144,136,128,120,112,104,96,88,80,72,64,56,48,40,32,24,16,8,4,2,1],"max_capture_size":512}
WARNING 05-04 19:14:21 [utils.py:2444] Methods determine_num_available_blocks,device_config,get_cache_block_size_bytes,initialize_cache not implemented in <vllm.v1.worker.gpu_worker.Worker object at 0x7c36b0a92110>
INFO 05-04 19:14:22 [parallel_state.py:959] rank 0 in world size 1 is assigned as DP rank 0, PP rank 0, TP rank 0
INFO 05-04 19:14:22 [cuda.py:221] Using Flash Attention backend on V1 engine.
INFO 05-04 19:14:30 [gpu_model_runner.py:1276] Starting to load model Qwen/Qwen2.5-VL-3B-Instruct...
INFO 05-04 19:14:30 [config.py:3466] cudagraph sizes specified by model runner [1, 2, 4, 8, 16, 24, 32, 40, 48, 56, 64, 72, 80, 88, 96, 104, 112, 120, 128, 136, 144, 152, 160, 168, 176, 184, 192, 200, 208, 216, 224, 232, 240, 248, 256, 264, 272, 280, 288, 296, 304, 312, 320, 328, 336, 344, 352, 360, 368, 376, 384, 392, 400, 408, 416, 424, 432, 440, 448, 456, 464, 472, 480, 488, 496, 504, 512] is overridden by config [512, 384, 256, 128, 4, 2, 1, 392, 264, 136, 8, 400, 272, 144, 16, 408, 280, 152, 24, 416, 288, 160, 32, 424, 296, 168, 40, 432, 304, 176, 48, 440, 312, 184, 56, 448, 320, 192, 64, 456, 328, 200, 72, 464, 336, 208, 80, 472, 344, 216, 88, 120, 480, 352, 248, 224, 96, 488, 504, 360, 232, 104, 496, 368, 240, 112, 376]
WARNING 05-04 19:14:31 [topk_topp_sampler.py:69] FlashInfer is not available. Falling back to the PyTorch-native implementation of top-p & top-k sampling. For the best performance, please install FlashInfer.
INFO 05-04 19:14:31 [gpu_model_runner.py:1291] Model loading took 7.1557 GiB and 0.449378 seconds
INFO 05-04 19:14:37 [gpu_model_runner.py:1560] Encoder cache will be initialized with a budget of 16384 tokens, and profiled with 1 image items of the maximum feature size.
INFO 05-04 19:14:55 [backends.py:416] Using cache directory: /home/wiss/liao/.cache/vllm/torch_compile_cache/5aff8ccb97/rank_0_0 for vLLM's torch.compile
INFO 05-04 19:14:55 [backends.py:426] Dynamo bytecode transform time: 12.63 s
INFO 05-04 19:14:56 [backends.py:115] Directly load the compiled graph for shape None from the cache
INFO 05-04 19:15:06 [monitor.py:33] torch.compile takes 12.63 s in total
INFO 05-04 19:15:07 [kv_cache_utils.py:634] GPU KV cache size: 298,128 tokens
INFO 05-04 19:15:07 [kv_cache_utils.py:637] Maximum concurrency for 4,096 tokens per request: 72.79x
INFO 05-04 19:15:35 [gpu_model_runner.py:1626] Graph capturing finished in 28 secs, took 3.93 GiB
INFO 05-04 19:15:35 [core.py:163] init engine (profile, create kv cache, warmup model) took 64.49 seconds
INFO 05-04 19:15:41 [block_pool.py:264] Successfully reset prefix cache
INFO 05-04 19:15:47 [gpu_worker.py:81] Sleep mode freed 22.78 GiB memory, 36.51 GiB memory is still in use.
INFO 05-04 19:15:47 [executor_base.py:210] It took 6.161845 seconds to fall asleep.
Sampling params: {'max_tokens': 2048, 'detokenize': False, 'logit_bias': {151655: -100}, 'n': 6, 'temperature': 1.0, 'top_p': 0.99, 'top_k': -1, 'seed': 1, 'ignore_eos': False}.
After vllm init: 36.51 GB / 93.02 GB.
Before state_dict() in sharding manager: 43.99 GB / 93.02 GB.
After state_dict() in sharding manager: 44.64 GB / 93.02 GB.
INFO 05-04 19:15:59 [executor_base.py:226] It took 0.241456 seconds to wake up tags ['weights'].
After sync model weights in sharding manager: 51.95 GB / 93.02 GB.
INFO 05-04 19:15:59 [executor_base.py:226] It took 0.002655 seconds to wake up tags ['kv_cache'].
After del state_dict and empty_cache in sharding manager: 54.46 GB / 93.02 GB.
Before vllm offload in sharding manager: 36.30 GB / 93.02 GB.
INFO 05-04 19:16:16 [block_pool.py:264] Successfully reset prefix cache
INFO 05-04 19:16:17 [gpu_worker.py:81] Sleep mode freed 18.46 GiB memory, 17.83 GiB memory is still in use.
INFO 05-04 19:16:17 [executor_base.py:210] It took 0.730461 seconds to fall asleep.
After vllm offload in sharding manager: 17.83 GB / 93.02 GB.
{"__magic_token__": "__ray_tqdm_magic_token__", "x": 1, "pos": 2, "desc": "Compute log probs ((rollout)responses per GPU / batch_size_per_device for experience)", "total": 12, "unit": "it", "ip": "10.153.51.195", "pid": 1886580, "uuid": "2fd545bacb514260b2a4cb127e5b6fb4", "closed": false}
{"__magic_token__": "__ray_tqdm_magic_token__", "x": 4, "pos": 2, "desc": "Compute log probs ((rollout)responses per GPU / batch_size_per_device for experience)", "total": 12, "unit": "it", "ip": "10.153.51.195", "pid": 1886580, "uuid": "2fd545bacb514260b2a4cb127e5b6fb4", "closed": false}
{"__magic_token__": "__ray_tqdm_magic_token__", "x": 9, "pos": 2, "desc": "Compute log probs ((rollout)responses per GPU / batch_size_per_device for experience)", "total": 12, "unit": "it", "ip": "10.153.51.195", "pid": 1886580, "uuid": "2fd545bacb514260b2a4cb127e5b6fb4", "closed": false}
{"__magic_token__": "__ray_tqdm_magic_token__", "x": 1, "pos": 2, "desc": "Compute log probs ((rollout)responses per GPU / batch_size_per_device for experience)", "total": 12, "unit": "it", "ip": "10.153.51.195", "pid": 1886580, "uuid": "3679d22d7a514f1d8952a37877d6a0b6", "closed": false}
{"__magic_token__": "__ray_tqdm_magic_token__", "x": 2, "pos": 2, "desc": "Compute log probs ((rollout)responses per GPU / batch_size_per_device for experience)", "total": 12, "unit": "it", "ip": "10.153.51.195", "pid": 1886580, "uuid": "3679d22d7a514f1d8952a37877d6a0b6", "closed": false}
{"__magic_token__": "__ray_tqdm_magic_token__", "x": 7, "pos": 2, "desc": "Compute log probs ((rollout)responses per GPU / batch_size_per_device for experience)", "total": 12, "unit": "it", "ip": "10.153.51.195", "pid": 1886580, "uuid": "3679d22d7a514f1d8952a37877d6a0b6", "closed": false}
{"__magic_token__": "__ray_tqdm_magic_token__", "x": 11, "pos": 2, "desc": "Compute log probs ((rollout)responses per GPU / batch_size_per_device for experience)", "total": 12, "unit": "it", "ip": "10.153.51.195", "pid": 1886580, "uuid": "3679d22d7a514f1d8952a37877d6a0b6", "closed": false}
{"__magic_token__": "__ray_tqdm_magic_token__", "x": 1, "pos": 2, "desc": "Train mini-batches ((rollout)responses per_GPU / per_GPU [update]responses)", "total": 2, "unit": "it", "ip": "10.153.51.195", "pid": 1886580, "uuid": "8153e71785934977ae212a687e0a2837", "closed": false}
{"__magic_token__": "__ray_tqdm_magic_token__", "x": 1, "pos": 3, "desc": "Update policy ((update)responses per_GPU / batch_per_device_for_update)", "total": 12, "unit": "it", "ip": "10.153.51.195", "pid": 1886580, "uuid": "341ed3b522bd4f2d9b5d745cf4cf597f", "closed": false}
{"__magic_token__": "__ray_tqdm_magic_token__", "x": 2, "pos": 3, "desc": "Update policy ((update)responses per_GPU / batch_per_device_for_update)", "total": 12, "unit": "it", "ip": "10.153.51.195", "pid": 1886580, "uuid": "341ed3b522bd4f2d9b5d745cf4cf597f", "closed": false}
{"__magic_token__": "__ray_tqdm_magic_token__", "x": 4, "pos": 3, "desc": "Update policy ((update)responses per_GPU / batch_per_device_for_update)", "total": 12, "unit": "it", "ip": "10.153.51.195", "pid": 1886580, "uuid": "341ed3b522bd4f2d9b5d745cf4cf597f", "closed": false}
{"__magic_token__": "__ray_tqdm_magic_token__", "x": 6, "pos": 3, "desc": "Update policy ((update)responses per_GPU / batch_per_device_for_update)", "total": 12, "unit": "it", "ip": "10.153.51.195", "pid": 1886580, "uuid": "341ed3b522bd4f2d9b5d745cf4cf597f", "closed": false}
{"__magic_token__": "__ray_tqdm_magic_token__", "x": 8, "pos": 3, "desc": "Update policy ((update)responses per_GPU / batch_per_device_for_update)", "total": 12, "unit": "it", "ip": "10.153.51.195", "pid": 1886580, "uuid": "341ed3b522bd4f2d9b5d745cf4cf597f", "closed": false}
{"__magic_token__": "__ray_tqdm_magic_token__", "x": 10, "pos": 3, "desc": "Update policy ((update)responses per_GPU / batch_per_device_for_update)", "total": 12, "unit": "it", "ip": "10.153.51.195", "pid": 1886580, "uuid": "341ed3b522bd4f2d9b5d745cf4cf597f", "closed": false}
{"__magic_token__": "__ray_tqdm_magic_token__", "x": 12, "pos": 3, "desc": "Update policy ((update)responses per_GPU / batch_per_device_for_update)", "total": 12, "unit": "it", "ip": "10.153.51.195", "pid": 1886580, "uuid": "341ed3b522bd4f2d9b5d745cf4cf597f", "closed": false}
{"__magic_token__": "__ray_tqdm_magic_token__", "x": 2, "pos": 2, "desc": "Train mini-batches ((rollout)responses per_GPU / per_GPU [update]responses)", "total": 2, "unit": "it", "ip": "10.153.51.195", "pid": 1886580, "uuid": "8153e71785934977ae212a687e0a2837", "closed": false}
{"__magic_token__": "__ray_tqdm_magic_token__", "x": 1, "pos": 3, "desc": "Update policy ((update)responses per_GPU / batch_per_device_for_update)", "total": 12, "unit": "it", "ip": "10.153.51.195", "pid": 1886580, "uuid": "189ed3d84edd4c32a11f23fbf34d3226", "closed": false}
{"__magic_token__": "__ray_tqdm_magic_token__", "x": 3, "pos": 3, "desc": "Update policy ((update)responses per_GPU / batch_per_device_for_update)", "total": 12, "unit": "it", "ip": "10.153.51.195", "pid": 1886580, "uuid": "189ed3d84edd4c32a11f23fbf34d3226", "closed": false}
{"__magic_token__": "__ray_tqdm_magic_token__", "x": 5, "pos": 3, "desc": "Update policy ((update)responses per_GPU / batch_per_device_for_update)", "total": 12, "unit": "it", "ip": "10.153.51.195", "pid": 1886580, "uuid": "189ed3d84edd4c32a11f23fbf34d3226", "closed": false}
{"__magic_token__": "__ray_tqdm_magic_token__", "x": 7, "pos": 3, "desc": "Update policy ((update)responses per_GPU / batch_per_device_for_update)", "total": 12, "unit": "it", "ip": "10.153.51.195", "pid": 1886580, "uuid": "189ed3d84edd4c32a11f23fbf34d3226", "closed": false}
{"__magic_token__": "__ray_tqdm_magic_token__", "x": 8, "pos": 3, "desc": "Update policy ((update)responses per_GPU / batch_per_device_for_update)", "total": 12, "unit": "it", "ip": "10.153.51.195", "pid": 1886580, "uuid": "189ed3d84edd4c32a11f23fbf34d3226", "closed": false}
{"__magic_token__": "__ray_tqdm_magic_token__", "x": 10, "pos": 3, "desc": "Update policy ((update)responses per_GPU / batch_per_device_for_update)", "total": 12, "unit": "it", "ip": "10.153.51.195", "pid": 1886580, "uuid": "189ed3d84edd4c32a11f23fbf34d3226", "closed": false}
{"__magic_token__": "__ray_tqdm_magic_token__", "x": 12, "pos": 3, "desc": "Update policy ((update)responses per_GPU / batch_per_device_for_update)", "total": 12, "unit": "it", "ip": "10.153.51.195", "pid": 1886580, "uuid": "189ed3d84edd4c32a11f23fbf34d3226", "closed": false}
Before state_dict() in sharding manager: 25.61 GB / 93.02 GB.
After state_dict() in sharding manager: 26.26 GB / 93.02 GB.
